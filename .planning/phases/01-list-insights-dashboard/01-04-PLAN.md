---
phase: 01-list-insights-dashboard
plan: 04
type: execute
wave: 3
depends_on: ["01-02", "01-03"]
files_modified:
  - frontend/src/pages/insights/ListInsightsPage.tsx
  - frontend/src/pages/insights/MasterInsightsPage.tsx
  - frontend/src/pages/insights/index.ts
  - frontend/src/App.tsx
  - frontend/src/components/lists/content/ListContent.tsx
  - frontend/src/pages/myLists/MyListsPage.tsx
autonomous: false

requirements: []

must_haves:
  truths:
    - "User can navigate to /list/:id/insights from a list view via an Insights button"
    - "User can navigate to master insights from the lists page header"
    - "Per-list insights page shows bento grid with all 7 metric cards for that list's data"
    - "Master insights page shows bento grid with all 7 metric cards aggregated across all lists"
    - "Both pages show loading skeleton while data loads"
    - "Both pages show empty state when list has fewer than 3 items"
    - "Breadcrumb navigation allows returning to list view or lists page"
    - "Cards stack vertically on mobile (single column)"
  artifacts:
    - path: "frontend/src/pages/insights/ListInsightsPage.tsx"
      provides: "Per-list insights page at /list/:id/insights"
      exports: ["default"]
    - path: "frontend/src/pages/insights/MasterInsightsPage.tsx"
      provides: "Master insights page"
      exports: ["default"]
    - path: "frontend/src/App.tsx"
      provides: "Routes for insights pages"
      contains: "insights"
  key_links:
    - from: "frontend/src/pages/insights/ListInsightsPage.tsx"
      to: "frontend/src/hooks/insights/useListInsights.ts"
      via: "useListInsights(listId) for data"
      pattern: "useListInsights"
    - from: "frontend/src/pages/insights/MasterInsightsPage.tsx"
      to: "frontend/src/hooks/insights/useMasterInsights.ts"
      via: "useMasterInsights() for aggregated data"
      pattern: "useMasterInsights"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/pages/insights/ListInsightsPage.tsx"
      via: "Route path /list/:id/insights"
      pattern: "Route.*path.*list.*insights"
    - from: "frontend/src/components/lists/content/ListContent.tsx"
      to: "/list/:id/insights"
      via: "Link/button navigating to insights page"
      pattern: "insights"
---

<objective>
Create the insights pages, wire them into the router, and add entry point buttons in the existing lists UI.

Purpose: Complete the feature by creating the two page components (per-list and master), adding routes to App.tsx, and integrating entry point buttons into the existing MyListsPage/ListContent. This connects all prior work (types, aggregators, charts, cards, hooks) into a user-facing feature.

Output: Two functional insights pages accessible via routing, with entry points from the lists UI.
</objective>

<execution_context>
@/home/gustaffaivre/.claude/get-shit-done/workflows/execute-plan.md
@/home/gustaffaivre/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-list-insights-dashboard/01-02-SUMMARY.md
@.planning/phases/01-list-insights-dashboard/01-03-SUMMARY.md
@frontend/src/App.tsx
@frontend/src/pages/myLists/MyListsPage.tsx
@frontend/src/components/lists/content/ListContent.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ListInsightsPage and MasterInsightsPage</name>
  <files>
    frontend/src/pages/insights/ListInsightsPage.tsx
    frontend/src/pages/insights/MasterInsightsPage.tsx
    frontend/src/pages/insights/index.ts
  </files>
  <action>
1. Create `frontend/src/pages/insights/ListInsightsPage.tsx`:
   - Import useParams from react-router-dom (get `id` param)
   - Import useNavigate, Link from react-router-dom
   - Import useListInsights from ../../hooks/insights
   - Import useListById from ../../hooks/lists/useLists (for list name in breadcrumb)
   - Import all card components: HeroStatCard, GenreDonutCard, TopGenresCard, RatingComparisonCard, TopPeopleCard, ActiveMonthCard, ReleaseYearCard
   - Import BentoGrid, InsightsEmptyState, InsightsSkeleton
   - Import ChevronLeft from lucide-react

   Component structure:
   a. Parse listId from URL params: `const { id } = useParams(); const listId = Number(id);`
   b. Call `useListInsights(listId)` and `useListById(listId)` for breadcrumb data
   c. Breadcrumb nav (per user specifics): `<nav aria-label="Breadcrumb"><ol>` with "Lists" > "{list name}" > "Insights" using `<Link>` components. Current page has `aria-current="page"`. Style with `text-subtle` for links, `text-text-h1` for current.
   d. Page title: "Insights" with back button (ChevronLeft icon + Link to /lists)
   e. Loading state: render InsightsSkeleton
   f. Empty state: render InsightsEmptyState when totalCount < 3, with onBrowse navigating to home
   g. Data state: render BentoGrid containing all 7 cards in this order:
      - HeroStatCard (totalCount)
      - GenreDonutCard (genreDistribution)
      - TopPeopleCard (topActors, topDirectors)
      - TopGenresCard (topGenres)
      - RatingComparisonCard (ratingComparison)
      - ActiveMonthCard (mostActiveMonth)
      - ReleaseYearCard (releaseYearBreakdown)
   h. Wrap page in container with padding: `px-4 md:px-8 py-6 mt-20 lg:mt-24 max-w-7xl mx-auto`
   i. Add subtle gradient background behind the bento grid for glassmorphism depth:
      `<div className="relative">` with a gradient div positioned absolute behind the grid

2. Create `frontend/src/pages/insights/MasterInsightsPage.tsx`:
   - Same structure as ListInsightsPage but:
   - Import useMasterInsights instead of useListInsights
   - Breadcrumb: "Lists" > "All Insights"
   - Title: "All Lists Insights" with subtitle showing total list count
   - Same card layout in BentoGrid
   - Same empty state handling (< 3 items across all lists)

3. Create `frontend/src/pages/insights/index.ts`:
   - Barrel export: ListInsightsPage and MasterInsightsPage as named exports
  </action>
  <verify>
    Run `cd frontend && npx tsc --noEmit` — no type errors.
  </verify>
  <done>
    ListInsightsPage renders per-list insights with breadcrumb, loading, empty, and data states. MasterInsightsPage renders aggregated insights. Both use BentoGrid with all 7 cards.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add routes to App.tsx and entry point buttons to lists UI</name>
  <files>
    frontend/src/App.tsx
    frontend/src/components/lists/content/ListContent.tsx
    frontend/src/pages/myLists/MyListsPage.tsx
  </files>
  <action>
1. Update `frontend/src/App.tsx`:
   - Import ListInsightsPage and MasterInsightsPage from ./pages/insights
   - Add two new Routes AFTER the `/lists` route:
     - `<Route path="/list/:id/insights" element={<ListInsightsPage />} />`
     - `<Route path="/lists/insights" element={<MasterInsightsPage />} />`

2. Update `frontend/src/components/lists/content/ListContent.tsx`:
   - Read the file first to understand its current structure
   - Add an "Insights" button/link in the list header area (where the list title and actions are shown)
   - The button should only appear when viewing a specific list (activeView === "list" and selectedList exists)
   - Use `<Link to={`/list/${selectedList.id}/insights`}>` with BarChart3 icon from lucide-react
   - Style as a subtle secondary button: `inline-flex items-center gap-1.5 px-3 py-1.5 text-sm text-subtle hover:text-text-h1 bg-component-primary/40 hover:bg-component-primary/60 rounded-lg transition-colors`
   - Position near the view mode toggle or add-media button area

3. Update `frontend/src/pages/myLists/MyListsPage.tsx`:
   - Add a "View Insights" link in the header/top area of the lists page (master insights entry point)
   - This should be visible when user has lists with items
   - Use `<Link to="/lists/insights">` with BarChart3 icon
   - Style similar to the per-list insights button but slightly more prominent
   - Position in the main content header area, accessible from the lists page header per user decision
  </action>
  <verify>
    Run `cd frontend && npx tsc --noEmit` — no type errors. Run `cd frontend && npm run build:strict` — clean build.
  </verify>
  <done>
    Routes registered for /list/:id/insights and /lists/insights. Per-list insights accessible via button on list view. Master insights accessible from lists page header. Full build passes.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Visual and functional verification</name>
  <files>
    frontend/src/pages/insights/ListInsightsPage.tsx
    frontend/src/pages/insights/MasterInsightsPage.tsx
  </files>
  <action>
Human verifies the complete insights dashboard visually and functionally.
What was built: Complete insights dashboard with bento grid, glassmorphism cards, charts, stagger animations, and two entry points (per-list and master insights).
  </action>
  <verify>
    1. Start the dev server: `cd frontend && npm run dev`
    2. Navigate to /lists and sign in
    3. Verify "View Insights" link appears in lists page header
    4. Click "View Insights" — verify master insights page loads with:
       - Breadcrumb: "Lists > All Insights"
       - Bento grid with glassmorphism cards
       - Cards stagger-animate in on load
       - Hero stat shows total watched count with animated number
       - Genre donut chart renders with theme colors
       - Top genres show ranked list
       - Rating comparison shows two numbers
       - Top actors/directors show profile cards
       - Active month shows month name
       - Release year shows bar chart
       - On mobile (resize to 375px): all cards stack into single column
    5. Go back to /lists, select a specific list
    6. Verify "Insights" button appears on the list view
    7. Click it — verify per-list insights page loads with same card types but scoped to that list
    8. Verify breadcrumb: "Lists > {List Name} > Insights"
    9. Test empty state: create a new empty list, navigate to its insights — verify encouraging empty state with CTA
    10. Verify hover tooltips work on donut chart and bar chart
  </verify>
  <done>
    User has approved the visual appearance, responsiveness, and functionality of both insights pages. All cards render correctly, animations work, and entry points are accessible.
  </done>
  <resume-signal>Type "approved" or describe any issues with layout, styling, data, or animations</resume-signal>
</task>

</tasks>

<verification>
- `cd frontend && npm run build:strict` passes (TypeScript + production build)
- Routes /list/:id/insights and /lists/insights resolve to correct pages
- Entry point buttons visible in lists UI
- Bento grid responsive across breakpoints
- All 7 cards render data correctly
- Empty state shown for lists with < 3 items
- Loading skeleton shown during data fetch
- Stagger animation visible on page load
- Glassmorphism effect visible on cards
</verification>

<success_criteria>
- Two functional insights pages accessible via URL routing
- Entry point buttons integrated into existing lists UI
- Complete data pipeline: list data -> TMDB enrichment -> aggregation -> visualization
- Responsive bento grid with glassmorphism cards
- Loading, empty, and data states all functional
- Clean production build with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-list-insights-dashboard/01-04-SUMMARY.md`
</output>
